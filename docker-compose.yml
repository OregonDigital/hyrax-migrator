version: "3"

networks:
  external:
  internal:

services:
  ##
  # Basic Rails application build image
  app: &app
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - .:/data # mount current directory into the image
    # use tmpfs for tmp and log for performance and to allow
    # multiple builds in parallel. Both directories are mounted
    # into the image AFTER the working directory is mounted.
    tmpfs:
      - /data/log
    networks:
      external:
      internal:
    expose:
      - 3000
  server:
    <<: *app
    command: bundle exec rackup -s puma -p 3000 -o 0.0.0.0 config.ru
